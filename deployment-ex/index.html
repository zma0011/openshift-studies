
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.2">
    
    
      
        <title>Deployment examples - Redhat Openshift studies</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.19190aaf.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.24b84193.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deployments-examples" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Redhat Openshift studies" class="md-header-nav__button md-logo" aria-label="Redhat Openshift studies">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Redhat Openshift studies
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Deployment examples
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/jbcodeforce/openshift-studies/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Redhat Openshift studies" class="md-nav__button md-logo" aria-label="Redhat Openshift studies">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Redhat Openshift studies
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/jbcodeforce/openshift-studies/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Kubernetes fundamentals
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Kubernetes fundamentals" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Kubernetes fundamentals
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../k8s/k8s-0/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../k8s/k8s-1/" class="md-nav__link">
      Networking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../k8s/k8s-2/" class="md-nav__link">
      Security
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../k8s/k8s-faq/" class="md-nav__link">
      FAQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../k8s/k8s-comp/" class="md-nav__link">
      Compendium
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../docker/" class="md-nav__link">
      Docker tricks
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Openshift
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Openshift" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Openshift
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cp4i/" class="md-nav__link">
      cp4i
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../faq/" class="md-nav__link">
      FAQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../oc-cli/" class="md-nav__link">
      oc CLI
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Deployment examples
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Deployment examples
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deploy-zipkin-from-docker-image" class="md-nav__link">
    Deploy zipkin from docker image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-db2" class="md-nav__link">
    Deploy DB2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-rabbitmq" class="md-nav__link">
    Deploy RabbitMQ
  </a>
  
    <nav class="md-nav" aria-label="Deploy RabbitMQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#first-install-operator" class="md-nav__link">
    First install operator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-cluster" class="md-nav__link">
    Create a cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-sparks" class="md-nav__link">
    Deploy sparks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mongodb" class="md-nav__link">
    Mongodb
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-jupyter-lab" class="md-nav__link">
    Deploy Jupyter lab
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-helm-tiller-deprecated" class="md-nav__link">
    Deploy helm / tiller (DEPRECATED)
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../notes-ocp-training/" class="md-nav__link">
      notes certification
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../knative/" class="md-nav__link">
      Knative
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../sre/" class="md-nav__link">
      SRE
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../spark-on-os/" class="md-nav__link">
      Operators (with Spark)
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../opendatahub/" class="md-nav__link">
      Open Data Hub
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../istio/readme/" class="md-nav__link">
      Istio
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ansible/" class="md-nav__link">
      Ansible
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../odo-appsody/" class="md-nav__link">
      ODO - Appsody Summary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../compendium/" class="md-nav__link">
      Compendium
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deploy-zipkin-from-docker-image" class="md-nav__link">
    Deploy zipkin from docker image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-db2" class="md-nav__link">
    Deploy DB2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-rabbitmq" class="md-nav__link">
    Deploy RabbitMQ
  </a>
  
    <nav class="md-nav" aria-label="Deploy RabbitMQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#first-install-operator" class="md-nav__link">
    First install operator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-cluster" class="md-nav__link">
    Create a cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-sparks" class="md-nav__link">
    Deploy sparks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mongodb" class="md-nav__link">
    Mongodb
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-jupyter-lab" class="md-nav__link">
    Deploy Jupyter lab
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-helm-tiller-deprecated" class="md-nav__link">
    Deploy helm / tiller (DEPRECATED)
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jbcodeforce/openshift-studies/edit/master/docs/deployment-ex.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="deployments-examples">Deployments examples</h1>
<p>Multiple ways to deploy an app to openshift:</p>
<ol>
<li>
<p>Deploy an application from an existing Docker image. (Using <code>Deploy Image</code> in the project view.)</p>
<p><img alt="1" src="../images/deploy-image.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are two options: </p>
<ul>
<li>from an image imported in the openshift cluster, or built from a dockerfile inside the cluster. </li>
<li>by accessing a remote image repository like <code>Dockerhub</code> or <a href="https://quay.io">quay.io</a>. The image will be pulled down and stored within the internal OpenShift image registry. The image will then be copied to any node in the OpenShift cluster where an instance of the application will be scheduled.</li>
</ul>
<p>Application will, by default, be visible internally to the OpenShift cluster, and usually only to other applications within the same project. Use <code>Create route</code> to make the app public. </p>
</div>
</li>
<li>
<p>Build and deploy from source code contained in a Git repository using a <a href="https://github.com/openshift/source-to-image">Source-to-Image</a> toolkit.</p>
<p><img alt="2" src="../images/s2i-workflow.png" /></p>
<p>See <a href="https://www.youtube.com/watch?v=flI6zx9wH6M">this video to get s2i presentation</a> and <a href="#s2i">this section</a> goes to a simple Flask app deployment using s2i. </p>
</li>
<li>
<p>Build and deploy from source code contained in a Git repository from a Dockerfile.</p>
</li>
</ol>
<p>Build the first time</p>
<div class="highlight"><pre><span></span><code>oc new-build --binary --name<span class="o">=</span>vertx-greeting-application -l <span class="nv">app</span><span class="o">=</span>vertx-greeting-application
mvn dependency:copy-dependencies compile
oc start-build vertx-greeting-application --from-dir<span class="o">=</span>. --follow
oc new-app vertx-greeting-application -l <span class="nv">app</span><span class="o">=</span>vertx-greeting-application
oc expose service vertx-greeting-application
</code></pre></div>
<p>To update the application, just update the code and run:</p>
<div class="highlight"><pre><span></span><code>mvn dependency:copy-dependencies compile
oc start-build vertx-greeting-application --from-dir<span class="o">=</span>. --follow
</code></pre></div>
<ol>
<li>
<p>Using Helm charts and helm CLI: Helm can be used as well to define the config files and deploy. Here is a new CI/CD example done from scratch based on the <a href="https://ibm-cloud-architecture.github.io/refarch-reefer-ml">Reefer ML project simulator code</a>.</p>
<p><em>See <a href="https://docs.bitnami.com/kubernetes/how-to/create-your-first-helm-chart/">getting started</a> with helm guide.</em></p>
<ul>
<li>Create helm chart using the command <code>helm create</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> simulator/chart
helm create kcontainer-reefer-simulator
</code></pre></div>
<ul>
<li>
<p>Change the values.yaml to reflect environment and app settings. Remove Ingress as we will define Openshift route for the app to be visible.</p>
</li>
<li>
<p>In the templates folder modify the deployment.yaml to add env variables section:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">env</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PORT</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">.Values.service.servicePort</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">APPLICATION_NAME</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">.Release.Name</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">KAFKA_BROKERS</span>
        <span class="nt">valueFrom</span><span class="p">:</span>
          <span class="nt">configMapKeyRef</span><span class="p">:</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">.Values.kafka.brokersConfigMap</span><span class="nv"> </span><span class="s">}}&quot;</span>
            <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">brokers</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TELEMETRY_TOPIC</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">.Values.kafka.telemetryTopicName</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CONTAINER_TOPIC</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">.Values.kafka.containerTopicName</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="p p-Indicator">{{</span><span class="nv">- if .Values.eventstreams.enabled</span> <span class="p p-Indicator">}}</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">KAFKA_APIKEY</span>
        <span class="nt">valueFrom</span><span class="p">:</span>
          <span class="nt">secretKeyRef</span><span class="p">:</span>
            <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">.Values.eventstreams.apikeyConfigMap</span><span class="nv"> </span><span class="s">}}&quot;</span>
            <span class="nt">key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">binding</span>
      <span class="p p-Indicator">{{</span><span class="nv">- end</span> <span class="p p-Indicator">}}</span>
</code></pre></div>
<ul>
<li>Create helm template file for deployment:</li>
</ul>
<div class="highlight"><pre><span></span><code>helm template --output-dir templates --namespace eda-demo chart/kcontainer-reefer-simulator/
</code></pre></div>
<ul>
<li>Push the service.yaml and deployment.yml template to the gitops <a href="https://github.com/ibm-cloud-architecture/refarch-kc-gitops">repository</a> under the branch <code>eda-demo/gse-eda-demos.us-east.containers.appdomain.cloud</code>.</li>
<li>In the github repository define secrets environment variables for docker username and password, from your docker hub account.</li>
<li>When pushing the repository the gitAction will perform the build.</li>
</ul>
</li>
</ol>
<h2 id="deploy-zipkin-from-docker-image">Deploy zipkin from docker image</h2>
<p>Install it, and expose it with a service</p>
<p><div class="highlight"><pre><span></span><code>oc new-app --docker-image=openzipkin/zipkin

oc expose svc/zipkin
</code></pre></div>
A new route is created visible with <code>oc get routes</code>. Once the hostname is added to a DNS or /etc/hosts. </p>
<p>See zipkin architecture <a href="https://zipkin.io/pages/architecture.html">article here</a></p>
<h2 id="deploy-db2">Deploy DB2</h2>
<p>The Community edition DB2 image on <a href="https://hub.docker.com/r/ibmcom/db2">dockerhub</a>. It includes a predefined DB.</p>
<p>Clone the <a href="https://github.com/IBM/Db2">DB2 repository</a> to get the helm chart. See <a href="https://github.com/IBM/Db2/tree/develop/deployment">readme</a> in this repo, for installation using helm but <a href="#deploy-helm-tiller">tiller</a> needs to be installed before. The repository includes a script: <code>db2u-install</code></p>
<p>Create your own docker image with a shell to create the schema:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span> <span class="s">ibmcom/db2</span>

<span class="k">RUN</span> mkdir /var/custom
<span class="k">COPY</span> createschema.sh /var/custom
<span class="k">RUN</span> chmod a+x /var/custom/createschema.sh
</code></pre></div>
<p>Deinstalling configuration</p>
<div class="highlight"><pre><span></span><code>oc delete -n jbsandbox sa/db2u role/db2u-role rolebinding/db2u-rolebinding
</code></pre></div>
<h2 id="deploy-rabbitmq">Deploy RabbitMQ</h2>
<h3 id="first-install-operator">First install operator</h3>
<p>To create a RabbitMQ instance, a RabbitmqCluster resource definition must be created and applied. RabbitMQ Cluster Kubernetes Operator creates the necessary resources, such as Services and StatefulSet, in the same namespace in which the <code>RabbitmqCluster</code> CRD was defined.</p>
<p>See <a href="https://www.rabbitmq.com/kubernetes/operator/install-operator.html">some instructions here</a>. Be sure to have kubectl &gt;= 1.14</p>
<div class="highlight"><pre><span></span><code>git clone http://github.com/rabbitmq/cluster-operator.git
<span class="nb">cd</span> cluster-operator
kubectl create -f config/namespace/base/namespace.yaml
kubectl create -f config/crd/bases/rabbitmq.com_rabbitmqclusters.yaml
<span class="c1"># Add cluster roles and roles: rabbitmq-cluster-operator-role and rabbitmq-cluster-leader-election-role</span>
kubectl -n rabbitmq-system create --kustomize config/rbac/
kubectl -n rabbitmq-system create --kustomize config/manager/
<span class="c1"># Verify CRD installed</span>
kubectl get customresourcedefinitions.apiextensions.k8s.io <span class="p">|</span> grep rabbit
<span class="c1"># Verify the service account</span>
oc get sa rabbitmq-cluster-operator
<span class="c1"># link the service account to security policy</span>
oc adm policy add-scc-to-user privileged rabbitmq-cluster-operator
</code></pre></div>
<p>If there is an error about user 1000 not in range, change the deployment yaml file for the value <code>securityContext.runAsUser: 1000570000</code> to a value in range and remove the other runAsGroup and fsGroup.</p>
<h3 id="create-a-cluster">Create a cluster</h3>
<p>when the operator pod runs, create one instance create a yaml file:</p>
<div class="highlight"><pre><span></span><code>apiVersion: rabbitmq.com/v1beta1
kind: RabbitmqCluster
metadata:
  name: eda-rabbitmq
spec:
    replicas: <span class="m">1</span>
</code></pre></div>
<p>Then do</p>
<div class="highlight"><pre><span></span><code>oc apply -f rabbit-cluster.yaml 
oc get rabbitmqclusters
</code></pre></div>
<p>If an error like: "services \"eda-rabbitmq-rabbitmq-headless\" is forbidden: cannot set blockOwnerDeletion if an ownerReference refers to a resource you can't set finalizers on" happens, do the following: </p>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<h2 id="deploy-sparks">Deploy sparks</h2>
<p><a href="../spark-on-os/">Using the operator, see this note</a></p>
<h2 id="mongodb">Mongodb</h2>
<p>Define an env file with the following variables:
MONGODB_USER=mongo
MONGODB_PASSWORD=mongo
MONGODB_DATABASE=reeferdb
MONGODB_ADMIN_PASSWORD=password</p>
<p>then run:</p>
<div class="highlight"><pre><span></span><code>oc new-app --env-file=mongo.env --docker-image=openshift/mongodb-24-centos7
</code></pre></div>
<p>See the service:</p>
<div class="highlight"><pre><span></span><code>oc describe svc mongodb-24-centos7
</code></pre></div>
<p>For more detail see <a href="https://docs.openshift.com/enterprise/3.0/using_images/db_images/mongodb.html">this note</a></p>
<h2 id="deploy-jupyter-lab">Deploy Jupyter lab</h2>
<p>See <a href="https://blog.openshift.com/jupyter-openshift-part-2-using-jupyter-project-images/">this note</a> to deploy Jupyter lab lastest image to Openshift using the Deploy Image choice. The deployment is done under the project <code>reefer-shipment-solution</code></p>
<p><img alt="" src="../images/jupyterlab-1.png" /></p>
<p>The environment variable needs to be set to get Jupyter lab. </p>
<p><img alt="" src="../images/jupyterlab-2.png" /></p>
<p>It takes multiple minutes to deploy. For the permission error due to the jovyan user not known, the command was:</p>
<div class="highlight"><pre><span></span><code>oc adm policy add-scc-to-user anyuid -z default -n reefer-shipment-solution
</code></pre></div>
<div class="highlight"><pre><span></span><code> oc get routes
NAME  HOST/PORT   PATH      SERVICES                PORT       TERMINATION   WILDCARD
jupyterlab              jupyterlab-reefer-shipment-solution.greencluster-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud    all-spark-notebook   8888-tcp      None
</code></pre></div>
<p>Get the secuity token to login in via the pod logs.</p>
<div class="highlight"><pre><span></span><code>oc get pods 
NAME                             READY     STATUS      RESTARTS   AGE
all-spark-notebook-2-z4dqx  
</code></pre></div>
<div class="highlight"><pre><span></span><code>oc logs all-spark-notebook-2-z4dqx 
</code></pre></div>
<p>To avoid loosing the work on the notebook, we need to add PVC to <code>/home/jovyan/work</code> mount point</p>
<div class="highlight"><pre><span></span><code>oc get dc

oc set volume dc/all-spark-notebook  --add --mount-path /home/jovyan/work --claim-size=1G
</code></pre></div>
<h2 id="deploy-helm-tiller-deprecated">Deploy helm / tiller (DEPRECATED)</h2>
<p>The goal is to install Tiller server on its own project, and grant it permissions to one or more other projects where Helm Charts will be installed.</p>
<p>See the instructions in <a href="https://www.openshift.com/blog/getting-started-helm-openshift">this blog</a>.</p>
<p>Here is a quick summary of the commands performed</p>
<div class="highlight"><pre><span></span><code>oc new-project tiller
oc project tiller
export TILLER_NAMESPACE=tiller
oc process -f https://github.com/openshift/origin/raw/master/examples/helm/tiller-template.yaml -p TILLER_NAMESPACE=&quot;${TILLER_NAMESPACE}&quot; -p HELM_VERSION=v2.16.4 | oc create -f -
</code></pre></div>
<p>Once deployed and Tiller server running, create a new project and grant tiller edit role to access this new project, and then use helm CLI to deploy the app:</p>
<div class="highlight"><pre><span></span><code>oc new-project myapp
oc policy add-role-to-user edit <span class="s2">&quot;system:serviceaccount:</span><span class="si">${</span><span class="nv">TILLER_NAMESPACE</span><span class="si">}</span><span class="s2">:tiller&quot;</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../oc-cli/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                oc CLI
              </div>
            </div>
          </a>
        
        
          <a href="../notes-ocp-training/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                notes certification
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.7e0ee788.min.js"></script>
      <script src="../assets/javascripts/bundle.c1ccee15.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>